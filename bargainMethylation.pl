#!/usr/bin/env perl
use strict;
use warnings;
use Data::Dumper;
use 5.010_000;
use autodie;
use FindBin;
use lib "$FindBin::Bin/lib";
use FastaReader;
use GFF::Parser::Correlated;
use DBI;
use List::Util qw/max/;
use List::MoreUtils qw/all/;
use DBI;
use Getopt::Euclid qw( :vars<opt_> );
use Pod::Usage;
use File::Temp qw/mktemp tempfile/;
use DZUtil qw/approximate_line_count/;
use YAML qw/DumpFile/;

pod2usage(-verbose => 99,-sections => [qw/NAME SYNOPSIS OPTIONS/]) 
if !$opt_file || !$opt_output_prefix || !$opt_reference;

my $reference_genome = FastaReader->new(slurp => 1, file => $opt_reference, normalize => 0);
say STDERR "Genome read!" if $opt_verbose;

#######################################################################
# Database 

=head2 Internals

Create counters for c/t for each sequence.

=cut

{
    my $integer_width = 4;

    my %c_counter;
    my %t_counter;
    my %seqlen = $reference_genome->sequence_lengths();
    while (my ($seq,$len) = each %seqlen) {
        $c_counter{$seq} = "\0" x ($len * $integer_width);
        $t_counter{$seq} = "\0" x ($len * $integer_width);
    }

    # insert new or update existing position. 
    sub record_methylation{
        my ($seq, $coord, $base) = @_;

        $base = lc $base;

        if ($base eq 'c'){
            ++vec($c_counter{$seq}, $coord - 1, $integer_width * 8);
        }
        elsif ($base eq 't'){
            ++vec($t_counter{$seq}, $coord - 1, $integer_width * 8);
        }
    }

    sub record_output{
        # prefix-$seq.single-c-$context.gff.merged
        my $file_prefix = shift;


        # initialize statistics hash
        my %stats;
        for my $seq (sort keys %seqlen) {
            if ($opt_dinucleotide){
                $stats{$seq} = {
                    unfiltered => { map {$_ => 0} qw/C CG CC CA CT T TG TC TA TT/ },
                    filtered   => { map {$_ => 0} qw/C CG CC CA CT T TG TC TA TT/ },
                };
            }
            else{
                $stats{$seq} = {
                    unfiltered => { map {$_ => 0} qw/C CG CHH CHG T TG THH THG/ },
                    filtered   => { map {$_ => 0} qw/C CG CHH CHG T TG THH THG/ },
                };
            }
        }

        # create temp files
        my %filehandles; # write fh to temp files
        my %temp2real;   # temp file to final file map
        for my $context (@{$opt_dinucleotide ? [qw/CA CC CG CT CH/] : [qw/CG CHG CHH/]}){
            my $file = "$file_prefix.single-c.$context.gff.merged";
            my $tmpfile = mktemp($file . ".tmp.XXXX");
            open my $writer, q{>}, $tmpfile;
            $filehandles{$context} = $writer;
            $temp2real{$tmpfile} = $file;
        }

        for my $seq (sort keys %seqlen) {
            INDEX:
            for my $index (0 .. $seqlen{$seq} - 1) {
                my $coord = $index + 1;
                my $c = vec($c_counter{$seq}, $index, $integer_width * 8);
                my $t = vec($t_counter{$seq}, $index, $integer_width * 8);

                next INDEX if $c + $t == 0;

                my $context = $reference_genome->get_context($seq, $coord, dinuc => 0, undef_on_nonc => 1);
                next INDEX if ! defined $context; # means was not a C/G position
                $context = uc $context;

                my $filtered = $c + $t > 20 ? '*' : '';

                my $score = sprintf("%.4f", $c/($c+$t));
                say {$filehandles{$context}} join "\t", $seq, q{.}, $context, $coord, $coord, $score, q{.}, q{.}, "c=$c;t=$t$filtered";

                my $type = $filtered ? 'filtered' : 'unfiltered';

                $stats{$seq}{$type}{C} += $c;
                $stats{$seq}{$type}{T} += $t;
                $stats{$seq}{$type}{$context} += $c; # CG, CHG, CHH
                substr($context, 0, 1) = 'T';
                $stats{$seq}{$type}{$context} += $t; # TG, THG, THH
            }


        }
        close $_ for values %filehandles;
        while (my ($tmp,$real) = each %temp2real) {
            rename $tmp, $real;
        }
        return \%stats;
    }
}

#######################################################################

sub count_methylation{
    my ($gff, $bps) = @_;

    my ($seq, $start, $end, $reverse, $read_seq, $target_seq) = @$gff;
    $seq = $reference_genome->get_original_name($seq);
    my $filtered = 0;

    $bps->{$seq} += length($read_seq);

    my @target_bases = split //,$target_seq;
    my @read_bases = (q{.}, q{.}, split(//, $read_seq), q{.}, q{.});

    READ:
    for (my $strand_coord = $start; $strand_coord <= $end; ++$strand_coord){
        my $i = $strand_coord - $start + 2;
        my $abs_coord = $reverse ? $reference_genome->get_length($seq) - $strand_coord + 1 : $strand_coord;
        my $context;

        my $rbase = $read_bases[$i];
        if ($target_bases[$i] eq 'C' && ($rbase eq 'C' || $rbase eq 'T')){
            record_methylation($seq,$abs_coord,$rbase);
        }
        next READ;
    }
}


### {{{ print_freq

sub rat{
    my ($x,$y) = @_;
    if ($x+$y != 0){
        return sprintf("%.6f", $x/($x+$y));
    }
    else {
        return "0.000000";
    }
}

# this thing looks ridiculous...
sub print_freq{
    my $prefix = shift;
    my $error = shift;
    my %stats = @_;
    #DumpFile("$prefix.freq", \%stats);
    #return;

    open my $out, '>', "$prefix.freq";

    my @output;

    if ($opt_dinucleotide){
        push @output, [qw/seq bp overlaps 
        C CG CT CA CC 
        T TG TT TA TC
        C_ratio CG_ratio CT_ratio CA_ratio CC_ratio 

        filtered_C filtered_CG filtered_CT filtered_CA filtered_CC 
        filtered_T filtered_TG filtered_TT filtered_TA filtered_TC

        filtered_C_ratio filtered_CG_ratio filtered_CT_ratio filtered_CA_ratio filtered_CC_ratio 
        /];
    }
    else{
        push @output, [qw/seq bp overlaps 
        C CG CHG CHH 
        T TG THG THH 
        C_ratio CG_ratio CHG_ratio CHH_ratio 
        filtered_C filtered_CG filtered_CHG filtered_CHH 
        filtered_T filtered_TG filtered_THG filtered_THH 
        filtered_C_ratio filtered_CG_ratio filtered_CHG_ratio filtered_CHH_ratio 
        /];
    }

    for my $seq (sort keys %stats){
        if ($opt_dinucleotide){
            push @output, [
            $seq, $stats{$seq}{bp}, 0,

            $stats{$seq}{unfiltered}{C}, $stats{$seq}{unfiltered}{CG}, $stats{$seq}{unfiltered}{CT},$stats{$seq}{unfiltered}{CA}, $stats{$seq}{unfiltered}{CC}, 
            $stats{$seq}{unfiltered}{T}, $stats{$seq}{unfiltered}{TG}, $stats{$seq}{unfiltered}{TT},$stats{$seq}{unfiltered}{TA}, $stats{$seq}{unfiltered}{TC}, 

            rat($stats{$seq}{unfiltered}{C}  ,$stats{$seq}{unfiltered}{T} ),
            rat($stats{$seq}{unfiltered}{CG} ,$stats{$seq}{unfiltered}{TG} ),
            rat($stats{$seq}{unfiltered}{CT} ,$stats{$seq}{unfiltered}{TT} ),
            rat($stats{$seq}{unfiltered}{CA} ,$stats{$seq}{unfiltered}{TA} ),
            rat($stats{$seq}{unfiltered}{CC} ,$stats{$seq}{unfiltered}{TC} ),

            $stats{$seq}{filtered}{C}, $stats{$seq}{filtered}{CG}, $stats{$seq}{filtered}{CT},$stats{$seq}{filtered}{CA}, $stats{$seq}{filtered}{CC}, 
            $stats{$seq}{filtered}{T}, $stats{$seq}{filtered}{TG}, $stats{$seq}{filtered}{TT},$stats{$seq}{filtered}{TA}, $stats{$seq}{filtered}{TC}, 

            rat($stats{$seq}{filtered}{C}  ,$stats{$seq}{filtered}{T} ),
            rat($stats{$seq}{filtered}{CG} ,$stats{$seq}{filtered}{TG} ),
            rat($stats{$seq}{filtered}{CT} ,$stats{$seq}{filtered}{TT} ),
            rat($stats{$seq}{filtered}{CA} ,$stats{$seq}{filtered}{TA} ),
            rat($stats{$seq}{filtered}{CC} ,$stats{$seq}{filtered}{TC} ),
            ]
        }
        else{
            push @output, [
            $seq, $stats{$seq}{bp}, 0,

            $stats{$seq}{unfiltered}{C}, $stats{$seq}{unfiltered}{CG}, $stats{$seq}{unfiltered}{CHG}, $stats{$seq}{unfiltered}{CHH},
            $stats{$seq}{unfiltered}{T}, $stats{$seq}{unfiltered}{TG}, $stats{$seq}{unfiltered}{THG}, $stats{$seq}{unfiltered}{THH},

            rat($stats{$seq}{unfiltered}{C}  ,$stats{$seq}{unfiltered}{T} ),
            rat($stats{$seq}{unfiltered}{CG} ,$stats{$seq}{unfiltered}{TG} ),
            rat($stats{$seq}{unfiltered}{CHG},$stats{$seq}{unfiltered}{THG} ),
            rat($stats{$seq}{unfiltered}{CHH},$stats{$seq}{unfiltered}{THH} ),

            $stats{$seq}{filtered}{C}, $stats{$seq}{filtered}{CG}, $stats{$seq}{filtered}{CHG}, $stats{$seq}{filtered}{CHH},
            $stats{$seq}{filtered}{T}, $stats{$seq}{filtered}{TG}, $stats{$seq}{filtered}{THG}, $stats{$seq}{filtered}{THH},

            rat($stats{$seq}{filtered}{C}  , $stats{$seq}{filtered}{T} ),
            rat($stats{$seq}{filtered}{CG} , $stats{$seq}{filtered}{TG} ),
            rat($stats{$seq}{filtered}{CHG}, $stats{$seq}{filtered}{THG} ),
            rat($stats{$seq}{filtered}{CHH}, $stats{$seq}{filtered}{THH} ),
            ]
        }
    }

    #say scalar(@$_) for @output;
    my $numcols = $opt_dinucleotide ? 33 : 27;

    #die "uneven number of lines in freq? dying" unless all { $numcols == scalar @$_ } @output;

    for my $i (0..$numcols-1) {
        my $line = join "\t", sprintf("%18s", $output[0][$i]), map { $_->[$i] } @output[1 .. $#output];
        say STDERR $line;
        say $out $line;
    }
    say STDERR "error\t$error";
    say $out "error\t$error";
    close $out;

    #say Dumper \%stats;
}
# }}}

#######################################################################
# Main body

my $parser = GFF::Parser::Correlated->new(file => $opt_file, normalize => 0);
my %bps;

my $counter_increment = 10000; 

my $line_count = approximate_line_count($opt_file, 10000);

while (defined(my $corr = $parser->next())){
    count_methylation($corr, \%bps);

    if ($opt_verbose && $. % $counter_increment == 0){
        printf(STDERR "%d (%.4f%%)\n", $., $. / $line_count * 100);
    }
}

say STDERR "Done processing! creating single-c and freq file";

my $stats = record_output($opt_output_prefix);
while (my ($seq,$len) = each %bps) {
    $stats->{$seq}{bp} = $len;
}

print_freq($opt_output_prefix, $parser->no_match_counter() + $parser->error_counter(), %$stats);
#disconnect;

#######################################################################
# DONE

=head1 NAME

bargainMethylation.pl - third generation of countMethylation. current --new-cm in bs-sequel

=head1 SYNOPSIS

 bargainMethylation.pl -o file_prefix -r ref.fasta [-d] [-v] input.gff

=head1 OPTIONS

=over

=item  -o <prefix> | --output-prefix <prefix>

=item  -r <fasta> | --reference <fasta>

=for Euclid
    fasta.type:        readable

=item  -d | --dinucleotide 

=item --verbose | -v

=item  <file> 

=for Euclid
    file.type:        readable

=back

=cut
__DATA__
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:1804:1117#0/1:TTTTATGATGTGGTAATTTATTATTGGATGGGAAGTTTGAT	1567476	1567516	1	+	0	target=TGTCCCATGACGTGGCAACCTATTACTGGATGGGAAGTTCGACCG
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:1996:1117#0/1:TGGATTGTAAGAAATAGAGAAGAAGTTAATTAGTGATTGAA	17479814	17479854	1	-	0	target=TGTGGACTGCAAGAAATAGAGAAGAAGCTAATTAGTGACTGAATA
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:2211:1114#0/1:AGTTTATTATTGAGAGAGGTTTGTGGAAATATGAGAGAATG	95815	95855	1	-	0	target=TTAGTTTATTACTGAGAGAGGCTTGTGGAAACACGAGAGAATGCG
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:2375:1110#0/1:TTTGAATAGAGGTTATGGATTTTNTTTTTGTAGAAGTAATT	53181	53221	1	+	1	target=TGCTTGAATAGAGGTTATGGACCCCTTTTTCGTAGAAGTAATTCT
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:2392:1116#0/1:TTTTGGTTATATTATGAAAGTTTTATGAAGTTATAAGAAGT	0	0	0	.	.	.
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:3132:1115#0/1:TGTGTAAGATATTTTTTGAAAGAGAATTTTTTTAGAGATGA	14708724	14708764	1	+	0	target=AGCGCGTAAGATATTTCTTGAAAGAGAATTTTTCTAGAGATGATT
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:3177:1117#0/1:TTTATTTGATATGGGTAGGAGAAATGGTATTTTTTTTTTAA	138223	138263	1	+	0	target=GTTCTATTCGATACGGGTAGGAGAAACGGTATTCTTTTCTTAAAC
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:3197:1115#0/1:AAATAAGATATTTTTATTTATGTTTGTTGTGTGTAAGAAAA	6073818	6073858	1	-	0	target=TTAAACAAGACATCTCTATCCACGCTTGCCGTGCGTAAGAAAAGG
chrm	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:3227:1111#0/1:TGTTTTGGTAGGAAGTATTTTTTNTGAAGAATTGAATAAAA	148388	148428	1	+	1	target=CTCGCTTTGGCAGGAAGTATTTTTTTTGAAGAATTGAACAAAAAA
chrm	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:3470:1115#0/1:AATTTAAGATTTTTTAGAGTATTTTTGTTTTATTAATTTGT	42318	42358	1	-	0	target=ACAATCCAAGACCCCTCAGAGTATTTCTGTTTTATCAATTCGTTT
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:3700:1110#0/1:GTAAGAATAGTTTATATGAATGGNTTTTTTATTTTAAGATT	3167015	3167055	1	-	1	target=TTGCAAGAACAGTTTATACGAACGGTCTCTTTATTTCAAGATTTT
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:4405:1109#0/1:GAATTCGTGTATATGTATTAATTNTCGGGATTTCGTGATTT	1991034	1991074	1	+	1	target=AAGAACCCGTGTATATGCATCAACCTTCGGGATTCCGTGATCCCA
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:4434:1110#0/1:ATATGTATTAGTTGTAAAATATGNGGTTAATTTTATATTAG	7191215	7191255	1	-	1	target=TAATATGTATCAGCTGCAAAATATGAGGTTAATTTTACATCAGTT
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:4556:1111#0/1:ATTATGATTTTTGATGTGGTATANAATAATATAATAAATTA	21622283	21622323	1	+	1	target=AAATTATGATCCTTGATGTGGTATAGAACAACATAATAAATTAAT
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:4638:1110#0/1:AATTTGATAATTTATTAAGTTTTNAATTTAAATAAGTAAAT	8436366	8436406	1	+	1	target=GTAATTCGACAATTCATCAAGTCTCAAATCTAAATAAGTAAACAT
chr2	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:4681:1116#0/1:AGAAGAAAGGTGAAGAAGTTTTTAGTTTTGGTTTTGATTAA	11634907	11634947	1	+	0	target=TGAGAAGAAAGGTGAAGAAGCTCCTAGTCTTGGTCTTGATCAAGT
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:4813:1110#0/1:ATTTAATATGTGATGAAAGTATGNAAGTTTTGTTTTTTTGG	230904	230944	1	+	1	target=TAACTTAATATGCGACGAAAGCATGGAAGCTTCGTCTCTTTGGGA
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:5070:1117#0/1:TATTATTGTGGTAAAGGTTGTAATGTTAGAGGAATAATTAT	152908	152948	1	+	0	target=AGCATCATTGTGGTAAAGGTCGTAATGCCAGAGGAATAATTACCG
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5111:1110#0/1:AGTATTTTTTGTTGTGGTTTGGGNAGTAAAGGGTGTTTTTT	79140	79180	1	+	1	target=ATAGCATTTCCTGCTGCGGTTTGGGCAGCAAAGGGTGTTCCTCTT
chr2	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5164:1112#0/1:GAATTTTTAATTAGAAGATGTTTTGTATGTTTTGATGTAAT	12407634	12407674	1	+	0	target=GAGAATCTTCAATCAGAAGATGTCCCGCATGTTTTGATGTAACCT
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5203:1113#0/1:TTTGTTATTATATTGTTTAGGTATTTTTTGAATAAAATTAT	16466392	16466432	1	+	0	target=AGCCCGCCACCACACTGCTCAGGTACCTTCTGAATAAAATTACTA
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5388:1114#0/1:TTTAAAATATTAATTAATTTTTTTTTTGTTTTTTAAAGTTT	0	0	0	.	.	.
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5444:1109#0/1:AAGATATAAAGTTAAAGATTTATNTGGATTTTGGTTATATT	0	0	0	.	.	.
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5492:1112#0/1:TTAAAGTGGTTGTTGTGGTTGTTAGGTTTTAAGGTTAAGGT	14379089	14379129	1	+	0	target=GGCTAAAGCGGCTGCTGCGGTTGTTAGGCTCCAAGGTCAAGGCAA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5644:1109#0/1:GATTGTAAATTATAAGATTTTTTNAATTGTTTTTTTTGAAA	3176	3216	1	+	1	target=TTGATTGTAAATTATAAGATTTTTTTAATTGTTTTCCTTGAAAAG
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5744:1114#0/1:AAACGAAGATTATATTTATTTGGAGTTGTATGGATTATCTG	13175521	13175561	1	+	0	target=ATAAACGAAGATTATATTCACTTGGAGCCGTATGGATTACCTGAA
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:5987:1114#0/1:TTTATTTATTTTCGATTATTGATATTTTTTAATTGTGTTAT	26289299	26289339	1	+	0	target=CGTTTATCTATTTTCGATTACTGATACTTTCTAACCGTGTTATGT
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:6130:1111#0/1:TGGGTGATGAAGTAGGTTGTTGTNTATTTGATTTTGTTTAT	0	0	0	.	.	.
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:6323:1112#0/1:ATTATTTTTTTGGTTTGGTGATATAATATTATTATTTATGA	16485535	16485575	1	+	0	target=TAATTATTTCTTCGGTTTGGTGATACAACATTACTATTTATGATT
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:6363:1114#0/1:TTATTGATATTTTTATTATTTTTATTTTTAAAATGTAAGTG	15611785	15611825	1	+	0	target=ACCTATCGATATCTCTATTATTCTCATCTTCAAAACGTAAGTGTT
chr3	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:6449:1114#0/1:ACGATTTTTATTTTTGGTCGATAAATTTTCGGATTCGGTAA	9255571	9255611	1	-	0	target=CGACGATTTCCACTCCTGGTCGACAAATCCTCGGACCCGGTAAAC
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:6591:1110#0/1:TTGATGGTGTAGTCAAAGTCCATNTGAGTTTTTATTTTTGT	0	0	0	.	.	.
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:6718:1116#0/1:AAAGATTTTTTTTTAAATTGTATATATGATTTTTATTGAAT	13879	13919	1	-	0	target=TGAAAGATCTCCCTCCAAACCGTACATACGACTTTCATCGAATAC
chr2	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:6978:1114#0/1:TTTTTTTTGAGTTTGGGTTATGGATGAAGGAGAAGAAGGAA	3187168	3187208	1	+	0	target=TTCCTTCTCCGAGCTCGGGTTATGGACGAAGGAGAAGAAGGAACC
chr2	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7290:1114#0/1:TTTGTTTGGTTTGGAATATGGTTTAGAGAAATATTTAATTT	17180494	17180534	1	+	0	target=TCTTTGTTTGGTTTGGAACATGGTCTAGAGAAACATTCAATCCAG
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7436:1110#0/1:AGAGATTAGTTTATTTTTTGATTNGAAAAATAAGTTAATTT	0	0	0	.	.	.
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7501:1117#0/1:GAAGAGCGGTTCAGCAGGAATGCCGAGAACCGATCTCGTAT	0	0	0	.	.	.
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7535:1111#0/1:TAGGGGGGTTATTAGTTTATTGANTTTATTAAGTGTTATTT	0	0	0	.	.	.
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7552:1117#0/1:AGGAATGGAAAAAATTGTAGAAAATTGAGTAATTATATAAT	31433	31473	1	-	0	target=AGAGGAATGGAAAAAATTGCAGAAAACCGAGCAATTATACAATAT
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7636:1116#0/1:TATGAGTTATATTATGTAAATGTTAAATGTTTTTGGTGAGT	20144461	20144501	1	-	0	target=GCTATGAGCCACATCATGCAAATGTCAAATGTTCTCGGCGAGCAA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7679:1111#0/1:TATGAATAATTTTTTTTGGTATTNTATGTATATTTTTATGT	79283	79323	1	+	1	target=AACATGAATAACTCCCTTTGGTATTCTACGTACATTTTTACGTGA
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:7785:1111#0/1:TTAGTAATTAATTATATTTAAAANTTGAGTTAATATAATGT	10222308	10222348	1	+	1	target=GATTAGTAATTAATTACACTTAAAAATTGAGTTAACATAATGTAG
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:8104:1114#0/1:AGAATTTAGAATGTAAGAATGAATGGGTTTGTTTTGATTGT	45488	45528	1	-	0	target=TAAGAATTCAGAATGTAAGAATGAACGGGTTCGCTTTGACCGTTA
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:8155:1110#0/1:AGAAGGGATTTATAAATTAAATTNAATCGTCTAGTATACTG	15515317	15515357	1	+	1	target=CCAGAAGGGATCTATAAATCAAACTCAACCGCCTAGCATACTGAG
chr2	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:8268:1117#0/1:ATATTAGTAATATGGTTTAAAAATGATTTTGGTTTATATTA	15629450	15629490	1	-	0	target=CAACATCAGCAATATGGTTCAAAAATGATCCCGGTCTACATCAGT
chrm	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:8437:1111#0/1:ATTTGTATGTGTTAAGTATATAGNTAGTGTTTTTTTTGAGT	363215	363255	1	+	1	target=CGACTTGCATGTGTTAAGCATATAGCTAGCGTTCCTTCTGAGCCA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:8513:1110#0/1:AAAGGAGTTGAATGAAATTAAAGNTTTATGTTTGGTTTTGA	9294	9334	1	+	1	target=ATAAAGGAGCCGAATGAAACCAAAGTTTCATGTTCGGTTTTGAAT
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:8543:1114#0/1:GAAAAAATAATTTGATTTATAAGGTAAATTTTAAGGTTTGA	436602	436642	1	+	0	target=GGGAAAAAATAACTCGACTTACAAGGTAAATCCCAAGGCTCGAAG
chrm	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:8677:1117#0/1:TGAGTTTTGAGTAGGTAGAGTTAATGTAAGTAGGGTTAATG	299692	299732	1	-	0	target=AGCGAGCTCTGAGCAGGCAGAGCTAATGCAAGTAGGGCCAACGAG
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:8781:1111#0/1:ATAATTTTTATCGTATTTATATANTTTTTTGCGTATTTAAT	6077478	6077518	1	-	1	target=GTATAATCTCTATCGTATTCACATAACTTTTTGCGTATTTAATCC
chr3	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:9077:1118#0/1:AATTTGTAAGAAAAATTAATTTGTTAATTTTTTTTGAATAT	13437933	13437973	1	+	0	target=CAAACTCGTAAGAAAAATTAACTCGTTAATTTTTTTTGAATATTT
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:9177:1112#0/1:GAGAAGGAAAAGGAGTTTTTTTGGTGGATATTTTTTGGTTT	128416	128456	1	+	0	target=AAGAGAAGGAAAAGGAGCTTCTTCGGTGGATACCTCTTGGTCCTG
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:9371:1117#0/1:GAAGAAATAAAGTTAAAGATTTATATGGATTTTGGTTATAT	11743743	11743783	1	+	0	target=TAGAAGAAACAAAGCCAAAGACTCATATGGACTTTGGCTACACCA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:9445:1113#0/1:TTTTAGAATTATATGAAGTTAGTAAGTAAATAGTGAATTTA	130857	130897	1	-	0	target=GTTTTCAGAATTATATGAAGCCAGTAAGCAAACAGCGAATCCATG
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:9732:1111#0/1:TGTTTAGTATATTGGTGATTTTTNTTATATGAAATGGGAGT	0	0	0	.	.	.
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:10053:1113#0/1:TATGGATTTTGGTTATATTATGAAGGTTTTGAGAAGCTAGA	0	0	0	.	.	.
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:10217:1114#0/1:GTTAAAAATATAAAAATGATTAATTGATGTTGATTAAAATT	9344	9384	1	+	0	target=ACGTTAAAAATATAAAAATGATCAATCGACGTCGACTAAAACCCT
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:10457:1112#0/1:AGTTTTGTTTTTTTTGTTAATTCGAGTAATTTTATTTGTAT	27134077	27134117	1	-	0	target=TAAGCTTTGTCTTCCTTGCTAACCCGAGTAATCTTATTTGTACAT
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:10704:1112#0/1:AAATTTTACGGGTTATGTTTCGAGAAGAAAATAAAGAGAGA	10812243	10812283	1	+	0	target=CAAAATCTTACGGGCTATGCTTCGAGAAGAAAACAAAGAGAGATC
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:10810:1114#0/1:AGAATTATAGAATTGTTGTTGTGTTGATTGTTTTTAATGGA	7835324	7835364	1	-	0	target=GTAGAACTACAGAATTGTCGTCGTGTCGATCGTCTTCAATGGATT
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:11475:1115#0/1:TAGATAATTGAGGTTAATTTAGTTTTTAGATGAGTTTGGAT	102146	102186	1	-	0	target=GACAGACAATTGAGGCTAATCTAGCTCTCAGACGAGCTCGGACAC
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:11581:1114#0/1:TGTTAATGTTTTTTTTAGTATTTGGTTGAGATTTGTTTAAG	2174475	2174515	1	+	0	target=CGTGCCAATGTCTTCTCTAGTATCTGGCTGAGACTCGTTCAAGAA
chr2	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:11646:1113#0/1:TGGTAGGTTAGTTGGGTTATGAGTGTGGTGGGAATGGGTTT	16262319	16262359	1	-	0	target=GCTGGCAGGCCAGCCGGGCCATGAGCGCGGTGGGAACGGGCTTCC
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:11745:1111#0/1:AAGGGAATGGATGAGGTTTACAANAAAAGAATGGATTGGTA	14615223	14615263	1	-	1	target=GAAAGGGAATGGATGAGGCTTACAAGAAAAGAATGGATTGGTATC
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:11948:1116#0/1:TTAGAGATTATGAGTGTAATAGGAGTATTTGTTGATAAAAG	58392	58432	1	-	0	target=CTTCAGAGACTACGAGTGTAATAGGAGCATCCGTCGACAAAAGGA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:12200:1117#0/1:AAGAATATTTTTTTTATTGGGATGATAATTTTGAAAAGAAA	92379	92419	1	-	0	target=ACAAGAATATTTTTTTTATTGGGACGATAATTCTGAAAAGAAAGA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:12568:1114#0/1:ATAAATTAGAATTAAAATTTTAATAGTTGTAATTAATATTG	112309	112349	1	+	0	target=CTATAAATCAGAACCAAAATCCCAACAGTTGTAATTAATATTGAC
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:12632:1114#0/1:ATGTGTATGATTGAGTATAAGAATTTAAATCGGAATTATAT	0	0	0	.	.	.
chr2	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:12896:1114#0/1:GTAATGGATGTTTGAGGTAAAAATGTTTTATTTTTTTTTGT	11592020	11592060	1	+	0	target=CTGTAATGGATGCCTGAGGCAAAAATGCTCCATTTTCTTTTGCGC
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:12999:1112#0/1:AATTAATTATTTTTTTGTTTTTTNAAGTTTTTATGGTGTAG	0	0	0	.	.	.
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13022:1111#0/1:TGTTGTTGATGTTTATTTATAATNTAAATAAAATTAAGTTT	12903623	12903663	1	-	1	target=GTTGTTGTTGATGTTTATCTATAATACAAACAAAATTAAGTTCAA
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13303:1114#0/1:TAATTTTTTGTGAGATTGATTTTTTTTGATATTGATGAATT	7807569	7807609	1	+	0	target=AACAATCTTCCGTGAGATCGATTTCTTCTGACATCGATGAATCGA
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13332:1112#0/1:GTAGTATGTTTTTAGGAAAAGTGNTTATGTATTTTGGTTTA	5181385	5181425	1	-	1	target=AAGTAGTATGCCTTCAGGAAAAGCGCTCATGTATTTCGGTTTACT
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13432:1114#0/1:GATGGATAAGGATGATTGTTTGGATGTTAAAGAGATTGTTT	26335637	26335677	1	+	0	target=GCGACGGATAAGGATGATCGTCCGGATGCTAAAGAGATTGTTCAG
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13459:1117#0/1:TTTTTGGTTTTGTGTTTGTTAATAAGGATATATTATTTAGG	0	0	0	.	.	.
chr3	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13594:1115#0/1:GAGATTTTTTTTTAAAAGTATTTAGTTGGTGGGATTTTTTT	8640238	8640278	1	-	0	target=TGGAGATTCTCCTTCAAAAGCATTCAGTTGGTGGGACTCTTTCCC
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13641:1117#0/1:TATTTGTTTAATATTAGTATTTGTTAAGAAATATATTTTAG	11440858	11440898	1	-	0	target=ATTATCTGTTTAATATTAGTATTTGTTAAGAAATATATTTTAGTT
chr5	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:13713:1110#0/1:AAAATTTTATGATTCTACAATTTNTAAACAGTGAGGTCAAA	14110325	14110365	1	-	1	target=TTAAAACTTTATGACTCTACAACTTTTAAACAGTGAGGCCAAACT
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13807:1112#0/1:TTTTATTTAATTTTAAATTAATGAGTTATATATTAAGTATA	82613	82653	1	+	0	target=ATCTTTATCTAATCCTAAACCAACGAGTCACACACTAAGCATAGC
chrm	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:13863:1110#0/1:AGAATTTGATTTTGTATTTTTGTNTAATTGATATATGATAT	321898	321938	1	+	1	target=AAAGAATTCGACCTTGCACTCCCGCTCAATCGATATACGACATCG
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:13896:1114#0/1:TAATTTTATTGTTTGTTAGTTTTTTTTGTGAATTTTTTTGG	2145097	2145137	1	+	0	target=TTCAACTTCATTGTCTGTTAGTCTCTCTTGTGAATTTCTTTGGAG
chr1	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:14156:1115#0/1:TTTTAAGATTTGAGTTCTGTTATTGATGATTATTTCGATAG	8367571	8367611	1	-	0	target=ATCTTCAAGATTTGAGTTCTGTTATTGATGACTATCTCGATAGCC
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:14197:1113#0/1:TTTTTGAAGAAATTAGTGATTAAAGAATATTTTTTGAATTT	713775	713815	1	-	0	target=GATTCTTGAAGAAATCAGTGACCAAAGAACATTTCTTGAATTTGA
chrc	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:14261:1109#0/1:GTATTTAAGTAGTAAGTTTATTTNAAGATGAGTGTTTTTTT	107460	107500	1	+	1	target=AAGCATCTAAGTAGTAAGCCCACCCCAAGATGAGTGCTCTCCTAT
chrm	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:14445:1110#0/1:TAATTTTTGGAATTGTTAATTTGNATTTAGTTAATAGTTGA	196394	196434	1	+	2	target=GCTAACTCCCGGAATCGCCAACCCGAATTCAGCTAACAGCTGCTA
chrm	R/NM*	SOLEXA2_0531_FC62W31AAXX:4:1:14606:1116#0/1:TTTATATTTTTAATTTGTTGGTTTGTTAGGAAGGGAAGTTA	118215	118255	1	-	0	target=TCTTTACATCTCTAACTTGTTGGCTCGTTAGGAAGGGAAGTTAAA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:14699:1111#0/1:GTTATGAATATAAAGTTTTAAAGNATGGAATTTTAGAAAGA	38260	38300	1	+	1	target=TCGTTATGAACATAAAGTCCCAAAGTATGGAACCCTAGAAAGAGG
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:14896:1111#0/1:GATTTGTGTTTTGAATGGTTTTGNTAAAACGAATAATATTG	19981785	19981825	1	-	1	target=GAGACCTGCGTCTTGAATGGTTTTGATAAAACGAACAACATCGAG
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:14919:1110#0/1:AGGGTTTATTTGTAATTAATTTTNTAAATTTGTTTGGTATG	6865041	6865081	1	+	1	target=TAAGGGTTTACTTGTAACCAATCCTTCAAACCCGCTTGGTACGAC
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:15101:1115#0/1:GAAAAAGTTGTATTTTTGATGGAAGAATAGGAGATTTTTTT	130923	130963	1	-	0	target=AGGAAAAAGCCGCATTTTTGATGGAAGAACAGGAGATCCTTTTGA
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:15374:1111#0/1:ATTCGAAAATGATGAAATTCTAGNATGAAAATGCAACAAGA	4731819	4731859	1	+	1	target=AAATTCGAAAATGATGAAACCCTAGCATGAAAATGCAACAAGAAA
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:15392:1114#0/1:TGTTTTTATTATGGATGTTTTATTTTGTTTTTATTTATGAA	75664	75704	1	-	0	target=AGCGTCTTTATTATGGACGCTTTATTCTGTCTCCACTTATGAAAG
chr4	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:15848:1115#0/1:TGTAGTTTTGATTAGATTTTGGTAATGTAATTTTGAGAAAT	13102533	13102573	1	+	0	target=TTTGTAGCTCTGACCAGACTTTGGCAACGTAATTTTGAGAAATGC
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:15967:1116#0/1:GAAGAGCGGTTCAGCAGGAATGCCGAGACCGATCTCGTATG	0	0	0	.	.	.
chr1	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:16082:1113#0/1:TTTTATGTGATTTTAATAAAGTTATAGTTTTAAAAGTGGAA	8517878	8517918	1	+	0	target=GTTTCTATGTGACTTTAATAAAGTTATAGTTTCAAAAGTGGAAGC
chrc	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:16250:1112#0/1:TATAAGTGGTTGAATTTTTATTANGTAAGGGTTTATTGGAT	58417	58457	1	+	1	target=TTCACAAGCGGCTGAATCTTTATTACGTAAGGGCTTATTGGATGC
chr5	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:16407:1112#0/1:TGTGTTTGTTTAAATTTTTATATTATTTTGGTATTTTTGTA	13912450	13912490	1	+	0	target=TTTGTGTTTGTTCAAACTCTTACATTACTTTGGTATCTTTGTATA
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:16865:1112#0/1:GAAGAGCGGTTCAGCAGGAATGCNGAGACCGATCTCGTATG	0	0	0	.	.	.
chr2	U/NM	SOLEXA2_0531_FC62W31AAXX:4:1:16907:1112#0/1:ATTTTTTGTAGTGTTAAAATAAANATAGGTGAATTTATTGA	13283614	13283654	1	+	1	target=CTATTCTTCGCAGTGTTAAAACAAAAATAGGTGAATTTACTGAAA
.	NM/NM	SOLEXA2_0531_FC62W31AAXX:4:1:17033:1114#0/1:GTGTTTTTTTGTTAGAAGACATAAAGTTAAAGATTTATATG	0	0	0	.	.	.
