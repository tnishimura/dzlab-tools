#!/usr/bin/env perl
use strict;
use warnings;
use Data::Dumper;
use autodie;
use Tree::Range;
use Test::More qw(no_plan);
use List::Util qw/first/;
use FindBin;
use lib "$FindBin::Bin";
use testutils;

my $datatr = Tree::Range->new();
while (<DATA>){
    chomp;
    $datatr->add(split /\t/);
}
$datatr->finalize();

is(($datatr->search(87000))[0],'AT1G01200', "simple point test");

is(($datatr->search(87000.1))[0],'AT1G01200', "non-integer point test");

ok(!scalar($datatr->search(-1000)), "non-existent");

is_deeply(
    sort_results($datatr->search_overlap(180000,200000)),    
    sort_results(
        { overlap => (182358-180059+1), item => 'AT1G01490' },
        { overlap => (186923-185133+1), item => 'AT1G01500' },
        { overlap => (190056-187211+1), item => 'AT1G01510' },
        { overlap => (192139-190596+1), item => 'AT1G01520' },
        { overlap => (193670-192640+1), item => 'AT1G01530' },
        { overlap => (198684-195780+1), item => 'AT1G01540' },
        { overlap => (200000-199639+1), item => 'AT1G01550' },
    ),
    "deep test"
);

{
    my $tr = Tree::Range->new();
    eval { $tr->search(123,456) };
    ok(defined $@, "croaks when searched on empty/before finalization");
}

{
    my $tr = Tree::Range->new();
    $tr->add(100,150, "foo");
    eval { $tr->search(123,456) };
    ok(defined $@, "croaks when searched before finalize");
}


# the real-life test data below are the gene locations for chromosome 1 
# of arabidopsis thaliana, a plant used in genetics/genomcis.  Grabbed from
# arabidopsis.org
__DATA__
3631	5899	AT1G01010
6790	8737	AT1G01020
11649	13714	AT1G01030
23146	31227	AT1G01040
28500	28706	AT1G01046
31170	33153	AT1G01050
33379	37840	AT1G01060
38752	40944	AT1G01070
45296	47019	AT1G01080
47485	49286	AT1G01090
50075	51199	AT1G01100
52239	54692	AT1G01110
57269	59167	AT1G01120
61963	63811	AT1G01130
64166	67625	AT1G01140
70115	72138	AT1G01150
72339	74096	AT1G01160
73931	74737	AT1G01170
75633	77446	AT1G01180
78932	79032	AT1G01183
83045	84864	AT1G01190
86515	88213	AT1G01200
88898	89745	AT1G01210
91750	95651	AT1G01220
95987	97407	AT1G01225
97456	99240	AT1G01230
99894	101834	AT1G01240
104491	105330	AT1G01250
109032	111609	AT1G01260
111890	111961	AT1G01270
112263	113947	AT1G01280
114286	115549	AT1G01290
116943	118764	AT1G01300
119397	119997	AT1G01305
120154	121130	AT1G01310
121124	130099	AT1G01320
132328	135322	AT1G01340
136124	138162	AT1G01350
138513	139568	AT1G01355
141971	143183	AT1G01360
143564	145684	AT1G01370
147153	147942	AT1G01380
148120	149806	AT1G01390
150689	152210	AT1G01400
153113	154198	AT1G01410
154492	156011	AT1G01420
156801	158655	AT1G01430
159856	162572	AT1G01440
163419	166239	AT1G01448
164105	165517	AT1G01450
166589	167842	AT1G01453
168723	171165	AT1G01460
172146	172948	AT1G01470
173251	173466	AT1G01471
175782	178400	AT1G01480
180059	182358	AT1G01490
185133	186923	AT1G01500
187211	190056	AT1G01510
190596	192139	AT1G01520
192640	193670	AT1G01530
195780	198684	AT1G01540
199639	201775	AT1G01550
202136	204335	AT1G01560
205176	207435	AT1G01570
209395	213041	AT1G01580
214229	217304	AT1G01590
218994	221286	AT1G01600
221691	224340	AT1G01610
225665	227302	AT1G01620
229013	230917	AT1G01630
230994	232508	AT1G01640
232841	237817	AT1G01650
240057	242608	AT1G01660
242843	245988	AT1G01670
246411	248367	AT1G01680
249141	252462	AT1G01690
252947	254495	AT1G01695
259495	261474	AT1G01700
262828	267771	AT1G01710
268330	269819	AT1G01720
269792	270775	AT1G01725
270956	272061	AT1G01730
272111	274239	AT1G01740
275366	276310	AT1G01750
276266	278448	AT1G01760
278615	282891	AT1G01770
282761	284245	AT1G01780
284781	291094	AT1G01790
293342	295040	AT1G01800
295221	295859	AT1G01810
296001	298120	AT1G01820
298535	302315	AT1G01830
303537	304358	AT1G01840
304133	306287	AT1G01860
306384	306456	AT1G01870
306558	308991	AT1G01880
309275	309347	AT1G01890
310316	313130	AT1G01900
313101	315902	AT1G01910
316128	319650	AT1G01920
319836	322860	AT1G01930
323027	324917	AT1G01940
325473	330619	AT1G01950
330588	337582	AT1G01960
338291	340077	AT1G01970
340172	341999	AT1G01980
343166	344341	AT1G01990
345812	347592	AT1G02000
347891	352480	AT1G02010
352637	354969	AT1G02020
355321	357258	AT1G02030
358104	359078	AT1G02040
359117	360518	AT1G02050
360918	363094	AT1G02060
365209	367340	AT1G02065
370257	370967	AT1G02070
372064	372210	AT1G02074
373501	386847	AT1G02080
387277	389647	AT1G02090
389812	392816	AT1G02100
392939	395554	AT1G02110
395761	399897	AT1G02120
400035	401882	AT1G02130
403190	404456	AT1G02140
404600	408619	AT1G02145
408622	410611	AT1G02150
410748	411597	AT1G02160
411779	413554	AT1G02170
413522	414645	AT1G02180
415079	418010	AT1G02190
418767	422438	AT1G02205
427548	427811	AT1G02210
428814	430647	AT1G02220
435174	436776	AT1G02230
437951	439559	AT1G02250
440441	442877	AT1G02260
443149	446235	AT1G02270
448463	450426	AT1G02280
450527	452737	AT1G02290
453288	455463	AT1G02300
455688	458164	AT1G02305
458133	460696	AT1G02310
461828	461974	AT1G02320
462075	463612	AT1G02330
463855	464924	AT1G02335
465718	467844	AT1G02340
469818	470693	AT1G02350
471990	473160	AT1G02360
474500	476511	AT1G02370
477000	478971	AT1G02380
480852	483292	AT1G02390
483764	483919	AT1G02391
486801	489577	AT1G02400
489979	490505	AT1G02405
490925	492926	AT1G02410
493683	495158	AT1G02420
495050	496062	AT1G02430
496586	497479	AT1G02440
497976	498516	AT1G02450
504673	507204	AT1G02460
511765	513624	AT1G02470
513843	515404	AT1G02475
515494	515566	AT1G02480
516618	516734	AT1G02490
518251	520437	AT1G02500
520498	521668	AT1G02510
524134	528745	AT1G02520
529795	534677	AT1G02530
534827	535699	AT1G02540
536483	537211	AT1G02550
537860	540109	AT1G02560
541380	543983	AT1G02570
544783	549202	AT1G02580
552138	552761	AT1G02590
552640	552711	AT1G02600
553181	555854	AT1G02610
557092	557986	AT1G02620
560610	562424	AT1G02630
564205	567769	AT1G02640
568704	570418	AT1G02650
571955	574981	AT1G02660
576046	580299	AT1G02670
580625	582310	AT1G02680
584260	587219	AT1G02690
588329	589480	AT1G02700
589706	589996	AT1G02710
591826	594236	AT1G02720
594573	598657	AT1G02730
599416	602038	AT1G02740
602497	604292	AT1G02750
604402	604474	AT1G02760
604873	606693	AT1G02770
607808	609465	AT1G02780
610391	612324	AT1G02790
613216	616191	AT1G02800
618265	620480	AT1G02810
620678	621289	AT1G02813
621461	622469	AT1G02816
623765	624475	AT1G02820
625145	625608	AT1G02830
