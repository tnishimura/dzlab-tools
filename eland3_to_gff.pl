#!/usr/bin/env perl
use strict;
use warnings;
use Data::Dumper;
use feature 'say';
use autodie;
use Pod::Usage;
use Getopt::Long;

my $output = '-';
my $result = GetOptions ( "output" => \$output,);

if ($output ne '-'){
    open my $fh, '>', $output;
    select $fh; 
}


while (defined(my $line = <ARGV>)){
    chomp $line;
    my ($readid, $raw, undef, $position_array) = split /\t/, $line;

    my $len = length $raw;

    for my $mismatch (split /,/, $position_array) {
        if ($mismatch =~ /^([^:]+):(\d+)(F|R)(\d)/){
            my ($seq, $pos, $strand, $nummis) = ($1, $2, $3, $4);
            my $end = $pos + $len - 1;
            $strand = $strand eq 'F' ? '+' : '-';
            say "$seq\t$readid\tread\t$pos\t$end\t$nummis\t$strand\t.\t$raw";
        }
    }
}

=head1 NAME

 eland3_to_gff.pl -o output.gff input.gff

=cut


__DATA__
ILLUMINA04:1:100:1005:1753#0/1	GTGCGTTCGTGGCAAAAACTCACTTCGTGATTCGCGCGGGTACTTTTGTCAATTAATGCCAATATTGGCATATAT	0:0:1:0	CHR01:16919394F2
ILLUMINA04:1:100:1006:889#0/1	GATGATAATGCGAAAGGGCGCCGCGTCTGGGCGGGCGGGCTGAATGGATAAGCGACAGATGCCATGGAGTGGGGC	0:0:1:0	CHR09:4693413F2
ILLUMINA04:1:100:1008:1017#0/1	AATTCCCGCCAATGGCTGAGATGTTCAGTCGACTCCCTCCCCCTTTGTAGCGGTCTAGACCCCTACGAGTGAGCA	0:0:1:0	CHR12:8542591F2
ILLUMINA04:1:100:1010:30#0/1	AAAATGGTAATACATATCCTAGTAGCCTGTATTTATAGCTCGGGTGAAACGAGCTTCTGCTGCTATTGCGCTTCC	0:1:0:0	CHR11:21734368R1
ILLUMINA04:1:100:10:1204#0/1	ATAGTATTAGAAAAATGAAAAAAAATCCGACCTGCCGGATTCGAAACAGCGACCTAAGGATTAATCTGCCACACT	0:0:1:0	CHR04:31224726F2
ILLUMINA04:1:100:1018:1232#0/1	AACTCCTTCTTAACCCAACAGTTGTGATTGGAGTATCGATCTGTATTTTTGGACTCTTAACTGGAGCAGGAAGCA	0:1:0:0	CHR02:18469814R1
ILLUMINA04:1:100:102:1255#0/1	CCGCACATCCTTGGATTGACCTAAGAAATAAATAAAGTTAGCCAGTAAGGTAGTANTATTATGCAAATGATAGCG	0:0:1:0	CHR01:23525762R2
ILLUMINA04:1:100:1022:767#0/1	CTGGTATAGATTCAGCTCTCCCCAAACCAAGTGTTCAACATCTTCCCATGACGTCGCGGTGCCCAGATCCTCTCA	0:0:1:0	CHR03:15619807R2
ILLUMINA04:1:100:1022:770#0/1	AGCGCTCGTGTGGATTAAAAGTCCATTCAAACAGACATTTTTTAATTTAAATATATAGCTCTTAAAAATCTATGC	0:1:0:0	CHR09:10382655R1
ILLUMINA04:1:100:1023:1662#0/1	GCCTCACTGGGCTAATGGGAATTTGTCAGCTACGACAACTCAGAAAACTGGGAGTACTCTTCCAAGGTAATGCAG	0:1:0:0	CHR11:25748465F1
